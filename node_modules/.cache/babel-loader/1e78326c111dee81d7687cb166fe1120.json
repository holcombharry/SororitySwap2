{"ast":null,"code":"var _jsxFileName = \"/Users/harryholcomb/Desktop/React Native/GitHub/Sharetribe/ftw-product/src/containers/EditListingPage/EditListingWizard/EditListingWizardTab.js\";\nimport React from 'react';\nimport PropTypes from 'prop-types'; // Import configs and util modules\n\nimport { intlShape } from '../../../util/reactIntl';\nimport routeConfiguration from '../../../routing/routeConfiguration';\nimport { LISTING_PAGE_PARAM_TYPE_DRAFT, LISTING_PAGE_PARAM_TYPE_NEW, LISTING_PAGE_PARAM_TYPES } from '../../../util/urlHelpers';\nimport { ensureListing } from '../../../util/data';\nimport { createResourceLocatorString } from '../../../util/routes'; // Import modules from this directory\n\nimport EditListingDetailsPanel from './EditListingDetailsPanel/EditListingDetailsPanel';\nimport EditListingDeliveryPanel from './EditListingDeliveryPanel/EditListingDeliveryPanel';\nimport EditListingPhotosPanel from './EditListingPhotosPanel/EditListingPhotosPanel';\nimport EditListingPricingPanel from './EditListingPricingPanel/EditListingPricingPanel';\nimport css from './EditListingWizard.module.css';\nexport const DETAILS = 'details';\nexport const DELIVERY = 'delivery';\nexport const PRICING = 'pricing';\nexport const PHOTOS = 'photos'; // EditListingWizardTab component supports these tabs\n\nexport const SUPPORTED_TABS = [DETAILS, DELIVERY, PRICING, PHOTOS];\n\nconst pathParamsToNextTab = (params, tab, marketplaceTabs) => {\n  const nextTabIndex = marketplaceTabs.findIndex(s => s === tab) + 1;\n  const nextTab = nextTabIndex < marketplaceTabs.length ? marketplaceTabs[nextTabIndex] : marketplaceTabs[marketplaceTabs.length - 1];\n  return { ...params,\n    tab: nextTab\n  };\n}; // When user has update draft listing, he should be redirected to next EditListingWizardTab\n\n\nconst redirectAfterDraftUpdate = (listingId, params, tab, marketplaceTabs, history) => {\n  const listingUUID = listingId.uuid;\n  const currentPathParams = { ...params,\n    type: LISTING_PAGE_PARAM_TYPE_DRAFT,\n    id: listingUUID\n  };\n  const routes = routeConfiguration(); // Replace current \"new\" path to \"draft\" path.\n  // Browser's back button should lead to editing current draft instead of creating a new one.\n\n  if (params.type === LISTING_PAGE_PARAM_TYPE_NEW) {\n    const draftURI = createResourceLocatorString('EditListingPage', routes, currentPathParams, {});\n    history.replace(draftURI);\n  } // Redirect to next tab\n\n\n  const nextPathParams = pathParamsToNextTab(currentPathParams, tab, marketplaceTabs);\n  const to = createResourceLocatorString('EditListingPage', routes, nextPathParams, {});\n  history.push(to);\n};\n\nconst EditListingWizardTab = props => {\n  const {\n    tab,\n    marketplaceTabs,\n    params,\n    errors,\n    fetchInProgress,\n    newListingPublished,\n    history,\n    images,\n    availability,\n    listing,\n    handleCreateFlowTabScrolling,\n    handlePublishListing,\n    onUpdateListing,\n    onCreateListingDraft,\n    onImageUpload,\n    onRemoveImage,\n    onChange,\n    updatedTab,\n    updateInProgress,\n    intl\n  } = props;\n  const {\n    type\n  } = params;\n  const isNewURI = type === LISTING_PAGE_PARAM_TYPE_NEW;\n  const isDraftURI = type === LISTING_PAGE_PARAM_TYPE_DRAFT;\n  const isNewListingFlow = isNewURI || isDraftURI;\n  const currentListing = ensureListing(listing); // New listing flow has automatic redirects to new tab on the wizard\n  // and the last panel calls publishListing API endpoint.\n\n  const automaticRedirectsForNewListingFlow = (tab, listingId) => {\n    if (tab !== marketplaceTabs[marketplaceTabs.length - 1]) {\n      // Create listing flow: smooth scrolling polyfill to scroll to correct tab\n      handleCreateFlowTabScrolling(false); // After successful saving of draft data, user should be redirected to next tab\n\n      redirectAfterDraftUpdate(listingId, params, tab, marketplaceTabs, history);\n    } else {\n      handlePublishListing(listingId);\n    }\n  };\n\n  const onCompleteEditListingWizardTab = (tab, updateValues) => {\n    const onUpdateListingOrCreateListingDraft = isNewURI ? (tab, values) => onCreateListingDraft(values) : onUpdateListing;\n    const updateListingValues = isNewURI ? updateValues : { ...updateValues,\n      id: currentListing.id\n    };\n    onUpdateListingOrCreateListingDraft(tab, updateListingValues).then(r => {\n      if (isNewListingFlow) {\n        const listingId = r.data.data.id;\n        automaticRedirectsForNewListingFlow(tab, listingId);\n      }\n    }).catch(e => {// No need for extra actions\n    });\n  };\n\n  const panelProps = tab => {\n    return {\n      className: css.panel,\n      errors,\n      listing,\n      onChange,\n      panelUpdated: updatedTab === tab,\n      updateInProgress,\n      // newListingPublished and fetchInProgress are flags for the last wizard tab\n      ready: newListingPublished,\n      disabled: fetchInProgress\n    };\n  };\n\n  switch (tab) {\n    case DETAILS:\n      {\n        const submitButtonTranslationKey = isNewListingFlow ? 'EditListingWizard.saveNewDetails' : 'EditListingWizard.saveEditDetails';\n        return /*#__PURE__*/React.createElement(EditListingDetailsPanel, Object.assign({}, panelProps(DETAILS), {\n          submitButtonText: intl.formatMessage({\n            id: submitButtonTranslationKey\n          }),\n          onSubmit: values => {\n            onCompleteEditListingWizardTab(tab, values);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 9\n          }\n        }));\n      }\n\n    case DELIVERY:\n      {\n        const submitButtonTranslationKey = isNewListingFlow ? 'EditListingWizard.saveNewDelivery' : 'EditListingWizard.saveEditDelivery';\n        return /*#__PURE__*/React.createElement(EditListingDeliveryPanel, Object.assign({}, panelProps(DELIVERY), {\n          submitButtonText: intl.formatMessage({\n            id: submitButtonTranslationKey\n          }),\n          onSubmit: values => {\n            onCompleteEditListingWizardTab(tab, values);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 9\n          }\n        }));\n      }\n\n    case PRICING:\n      {\n        const submitButtonTranslationKey = isNewListingFlow ? 'EditListingWizard.saveNewPricing' : 'EditListingWizard.saveEditPricing';\n        return /*#__PURE__*/React.createElement(EditListingPricingPanel, Object.assign({}, panelProps(PRICING), {\n          submitButtonText: intl.formatMessage({\n            id: submitButtonTranslationKey\n          }),\n          onSubmit: values => {\n            onCompleteEditListingWizardTab(tab, values);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 9\n          }\n        }));\n      }\n\n    case PHOTOS:\n      {\n        const submitButtonTranslationKey = isNewListingFlow ? 'EditListingWizard.saveNewPhotos' : 'EditListingWizard.saveEditPhotos';\n        return /*#__PURE__*/React.createElement(EditListingPhotosPanel, Object.assign({}, panelProps(PHOTOS), {\n          submitButtonText: intl.formatMessage({\n            id: submitButtonTranslationKey\n          }),\n          images: images,\n          onImageUpload: onImageUpload,\n          onRemoveImage: onRemoveImage,\n          onSubmit: values => {\n            onCompleteEditListingWizardTab(tab, values);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 9\n          }\n        }));\n      }\n\n    default:\n      return null;\n  }\n};\n\n_c = EditListingWizardTab;\nEditListingWizardTab.defaultProps = {\n  listing: null,\n  updatedTab: null\n};\nconst {\n  array,\n  bool,\n  func,\n  object,\n  oneOf,\n  shape,\n  string\n} = PropTypes;\nEditListingWizardTab.propTypes = {\n  params: shape({\n    id: string.isRequired,\n    slug: string.isRequired,\n    type: oneOf(LISTING_PAGE_PARAM_TYPES).isRequired,\n    tab: oneOf(SUPPORTED_TABS).isRequired\n  }).isRequired,\n  errors: shape({\n    createListingDraftError: object,\n    publishListingError: object,\n    updateListingError: object,\n    showListingsError: object,\n    uploadImageError: object\n  }).isRequired,\n  fetchInProgress: bool.isRequired,\n  newListingPublished: bool.isRequired,\n  history: shape({\n    push: func.isRequired,\n    replace: func.isRequired\n  }).isRequired,\n  images: array.isRequired,\n  availability: object.isRequired,\n  // We cannot use propTypes.listing since the listing might be a draft.\n  listing: shape({\n    attributes: shape({\n      publicData: object,\n      description: string,\n      geolocation: object,\n      pricing: object,\n      title: string\n    }),\n    images: array\n  }),\n  handleCreateFlowTabScrolling: func.isRequired,\n  handlePublishListing: func.isRequired,\n  onUpdateListing: func.isRequired,\n  onCreateListingDraft: func.isRequired,\n  onImageUpload: func.isRequired,\n  onRemoveImage: func.isRequired,\n  onChange: func.isRequired,\n  updatedTab: string,\n  updateInProgress: bool.isRequired,\n  intl: intlShape.isRequired\n};\nexport default EditListingWizardTab;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditListingWizardTab\");","map":{"version":3,"sources":["/Users/harryholcomb/Desktop/React Native/GitHub/Sharetribe/ftw-product/src/containers/EditListingPage/EditListingWizard/EditListingWizardTab.js"],"names":["React","PropTypes","intlShape","routeConfiguration","LISTING_PAGE_PARAM_TYPE_DRAFT","LISTING_PAGE_PARAM_TYPE_NEW","LISTING_PAGE_PARAM_TYPES","ensureListing","createResourceLocatorString","EditListingDetailsPanel","EditListingDeliveryPanel","EditListingPhotosPanel","EditListingPricingPanel","css","DETAILS","DELIVERY","PRICING","PHOTOS","SUPPORTED_TABS","pathParamsToNextTab","params","tab","marketplaceTabs","nextTabIndex","findIndex","s","nextTab","length","redirectAfterDraftUpdate","listingId","history","listingUUID","uuid","currentPathParams","type","id","routes","draftURI","replace","nextPathParams","to","push","EditListingWizardTab","props","errors","fetchInProgress","newListingPublished","images","availability","listing","handleCreateFlowTabScrolling","handlePublishListing","onUpdateListing","onCreateListingDraft","onImageUpload","onRemoveImage","onChange","updatedTab","updateInProgress","intl","isNewURI","isDraftURI","isNewListingFlow","currentListing","automaticRedirectsForNewListingFlow","onCompleteEditListingWizardTab","updateValues","onUpdateListingOrCreateListingDraft","values","updateListingValues","then","r","data","catch","e","panelProps","className","panel","panelUpdated","ready","disabled","submitButtonTranslationKey","formatMessage","defaultProps","array","bool","func","object","oneOf","shape","string","propTypes","isRequired","slug","createListingDraftError","publishListingError","updateListingError","showListingsError","uploadImageError","attributes","publicData","description","geolocation","pricing","title"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\n// Import configs and util modules\nimport { intlShape } from '../../../util/reactIntl';\nimport routeConfiguration from '../../../routing/routeConfiguration';\nimport {\n  LISTING_PAGE_PARAM_TYPE_DRAFT,\n  LISTING_PAGE_PARAM_TYPE_NEW,\n  LISTING_PAGE_PARAM_TYPES,\n} from '../../../util/urlHelpers';\nimport { ensureListing } from '../../../util/data';\nimport { createResourceLocatorString } from '../../../util/routes';\n\n// Import modules from this directory\nimport EditListingDetailsPanel from './EditListingDetailsPanel/EditListingDetailsPanel';\nimport EditListingDeliveryPanel from './EditListingDeliveryPanel/EditListingDeliveryPanel';\nimport EditListingPhotosPanel from './EditListingPhotosPanel/EditListingPhotosPanel';\nimport EditListingPricingPanel from './EditListingPricingPanel/EditListingPricingPanel';\n\nimport css from './EditListingWizard.module.css';\n\nexport const DETAILS = 'details';\nexport const DELIVERY = 'delivery';\nexport const PRICING = 'pricing';\nexport const PHOTOS = 'photos';\n\n// EditListingWizardTab component supports these tabs\nexport const SUPPORTED_TABS = [DETAILS, DELIVERY, PRICING, PHOTOS];\n\nconst pathParamsToNextTab = (params, tab, marketplaceTabs) => {\n  const nextTabIndex = marketplaceTabs.findIndex(s => s === tab) + 1;\n  const nextTab =\n    nextTabIndex < marketplaceTabs.length\n      ? marketplaceTabs[nextTabIndex]\n      : marketplaceTabs[marketplaceTabs.length - 1];\n  return { ...params, tab: nextTab };\n};\n\n// When user has update draft listing, he should be redirected to next EditListingWizardTab\nconst redirectAfterDraftUpdate = (listingId, params, tab, marketplaceTabs, history) => {\n  const listingUUID = listingId.uuid;\n  const currentPathParams = {\n    ...params,\n    type: LISTING_PAGE_PARAM_TYPE_DRAFT,\n    id: listingUUID,\n  };\n  const routes = routeConfiguration();\n\n  // Replace current \"new\" path to \"draft\" path.\n  // Browser's back button should lead to editing current draft instead of creating a new one.\n  if (params.type === LISTING_PAGE_PARAM_TYPE_NEW) {\n    const draftURI = createResourceLocatorString('EditListingPage', routes, currentPathParams, {});\n    history.replace(draftURI);\n  }\n\n  // Redirect to next tab\n  const nextPathParams = pathParamsToNextTab(currentPathParams, tab, marketplaceTabs);\n  const to = createResourceLocatorString('EditListingPage', routes, nextPathParams, {});\n  history.push(to);\n};\n\nconst EditListingWizardTab = props => {\n  const {\n    tab,\n    marketplaceTabs,\n    params,\n    errors,\n    fetchInProgress,\n    newListingPublished,\n    history,\n    images,\n    availability,\n    listing,\n    handleCreateFlowTabScrolling,\n    handlePublishListing,\n    onUpdateListing,\n    onCreateListingDraft,\n    onImageUpload,\n    onRemoveImage,\n    onChange,\n    updatedTab,\n    updateInProgress,\n    intl,\n  } = props;\n\n  const { type } = params;\n  const isNewURI = type === LISTING_PAGE_PARAM_TYPE_NEW;\n  const isDraftURI = type === LISTING_PAGE_PARAM_TYPE_DRAFT;\n  const isNewListingFlow = isNewURI || isDraftURI;\n\n  const currentListing = ensureListing(listing);\n\n  // New listing flow has automatic redirects to new tab on the wizard\n  // and the last panel calls publishListing API endpoint.\n  const automaticRedirectsForNewListingFlow = (tab, listingId) => {\n    if (tab !== marketplaceTabs[marketplaceTabs.length - 1]) {\n      // Create listing flow: smooth scrolling polyfill to scroll to correct tab\n      handleCreateFlowTabScrolling(false);\n\n      // After successful saving of draft data, user should be redirected to next tab\n      redirectAfterDraftUpdate(listingId, params, tab, marketplaceTabs, history);\n    } else {\n      handlePublishListing(listingId);\n    }\n  };\n\n  const onCompleteEditListingWizardTab = (tab, updateValues) => {\n    const onUpdateListingOrCreateListingDraft = isNewURI\n      ? (tab, values) => onCreateListingDraft(values)\n      : onUpdateListing;\n\n    const updateListingValues = isNewURI\n      ? updateValues\n      : { ...updateValues, id: currentListing.id };\n\n    onUpdateListingOrCreateListingDraft(tab, updateListingValues)\n      .then(r => {\n        if (isNewListingFlow) {\n          const listingId = r.data.data.id;\n          automaticRedirectsForNewListingFlow(tab, listingId);\n        }\n      })\n      .catch(e => {\n        // No need for extra actions\n      });\n  };\n\n  const panelProps = tab => {\n    return {\n      className: css.panel,\n      errors,\n      listing,\n      onChange,\n      panelUpdated: updatedTab === tab,\n      updateInProgress,\n      // newListingPublished and fetchInProgress are flags for the last wizard tab\n      ready: newListingPublished,\n      disabled: fetchInProgress,\n    };\n  };\n\n  switch (tab) {\n    case DETAILS: {\n      const submitButtonTranslationKey = isNewListingFlow\n        ? 'EditListingWizard.saveNewDetails'\n        : 'EditListingWizard.saveEditDetails';\n      return (\n        <EditListingDetailsPanel\n          {...panelProps(DETAILS)}\n          submitButtonText={intl.formatMessage({ id: submitButtonTranslationKey })}\n          onSubmit={values => {\n            onCompleteEditListingWizardTab(tab, values);\n          }}\n        />\n      );\n    }\n    case DELIVERY: {\n      const submitButtonTranslationKey = isNewListingFlow\n        ? 'EditListingWizard.saveNewDelivery'\n        : 'EditListingWizard.saveEditDelivery';\n      return (\n        <EditListingDeliveryPanel\n          {...panelProps(DELIVERY)}\n          submitButtonText={intl.formatMessage({ id: submitButtonTranslationKey })}\n          onSubmit={values => {\n            onCompleteEditListingWizardTab(tab, values);\n          }}\n        />\n      );\n    }\n    case PRICING: {\n      const submitButtonTranslationKey = isNewListingFlow\n        ? 'EditListingWizard.saveNewPricing'\n        : 'EditListingWizard.saveEditPricing';\n      return (\n        <EditListingPricingPanel\n          {...panelProps(PRICING)}\n          submitButtonText={intl.formatMessage({ id: submitButtonTranslationKey })}\n          onSubmit={values => {\n            onCompleteEditListingWizardTab(tab, values);\n          }}\n        />\n      );\n    }\n    case PHOTOS: {\n      const submitButtonTranslationKey = isNewListingFlow\n        ? 'EditListingWizard.saveNewPhotos'\n        : 'EditListingWizard.saveEditPhotos';\n\n      return (\n        <EditListingPhotosPanel\n          {...panelProps(PHOTOS)}\n          submitButtonText={intl.formatMessage({ id: submitButtonTranslationKey })}\n          images={images}\n          onImageUpload={onImageUpload}\n          onRemoveImage={onRemoveImage}\n          onSubmit={values => {\n            onCompleteEditListingWizardTab(tab, values);\n          }}\n        />\n      );\n    }\n    default:\n      return null;\n  }\n};\n\nEditListingWizardTab.defaultProps = {\n  listing: null,\n  updatedTab: null,\n};\n\nconst { array, bool, func, object, oneOf, shape, string } = PropTypes;\n\nEditListingWizardTab.propTypes = {\n  params: shape({\n    id: string.isRequired,\n    slug: string.isRequired,\n    type: oneOf(LISTING_PAGE_PARAM_TYPES).isRequired,\n    tab: oneOf(SUPPORTED_TABS).isRequired,\n  }).isRequired,\n  errors: shape({\n    createListingDraftError: object,\n    publishListingError: object,\n    updateListingError: object,\n    showListingsError: object,\n    uploadImageError: object,\n  }).isRequired,\n  fetchInProgress: bool.isRequired,\n  newListingPublished: bool.isRequired,\n  history: shape({\n    push: func.isRequired,\n    replace: func.isRequired,\n  }).isRequired,\n  images: array.isRequired,\n  availability: object.isRequired,\n\n  // We cannot use propTypes.listing since the listing might be a draft.\n  listing: shape({\n    attributes: shape({\n      publicData: object,\n      description: string,\n      geolocation: object,\n      pricing: object,\n      title: string,\n    }),\n    images: array,\n  }),\n\n  handleCreateFlowTabScrolling: func.isRequired,\n  handlePublishListing: func.isRequired,\n  onUpdateListing: func.isRequired,\n  onCreateListingDraft: func.isRequired,\n  onImageUpload: func.isRequired,\n  onRemoveImage: func.isRequired,\n  onChange: func.isRequired,\n  updatedTab: string,\n  updateInProgress: bool.isRequired,\n\n  intl: intlShape.isRequired,\n};\n\nexport default EditListingWizardTab;\n"]},"metadata":{},"sourceType":"module"}